<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.427">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mattes Grundmann, Oya Bazer, Jakob Zschocke">
<meta name="dcterms.date" content="2023-06-07">

<title>DCL Real Data Example: Addiction Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="example_files/libs/clipboard/clipboard.min.js"></script>
<script src="example_files/libs/quarto-html/quarto.js"></script>
<script src="example_files/libs/quarto-html/popper.min.js"></script>
<script src="example_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="example_files/libs/quarto-html/anchor.min.js"></script>
<link href="example_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="example_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="example_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="example_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="example_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">DCL Real Data Example: Addiction Research</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mattes Grundmann, Oya Bazer, Jakob Zschocke </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction:</h3>
<p>While Randomized Controlled Trials (RCTs) are the gold standard for causal inference, these are often not feasible in addiction research for ethical and logistic reasons; for example, when studying the impact of smoking on cancer.</p>
<p>Instead, observational data from real-world settings are increasingly being used to inform clinical decisions and public health policies. This paper presents the framework for potential outcomes for causal inference and summarizes best practices in causal analysis for observational data. Among them: Matching, Inverse Probability Weighting (IPW), and Interrupted Time-Series Analysis (ITSA).</p>
<p>These methods will be explained using examples from addiction research, and the resulting results will be compared.</p>
<section id="required-packages-and-libraries" class="level4">
<h4 class="anchored" data-anchor-id="required-packages-and-libraries">Required packages and libraries:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=tidyverse"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"lmtest"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=lmtest"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"sandwich"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=sandwich"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"MatchIt"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=MatchIt"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"twang"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=twang"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"nlme"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=nlme"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=ggplot2"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tsModel"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=tsModel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt) </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(twang)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-methods-matching-and-iptw-will-be-explained-on-the-basis-of-the-following-observational-data-set" class="level4">
<h4 class="anchored" data-anchor-id="the-methods-matching-and-iptw-will-be-explained-on-the-basis-of-the-following-observational-data-set">The methods Matching and IPTW will be explained on the basis of the following (observational) data set:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>smk_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/gckc123/Causal_Analysis_Addiction_Examples/main/smoking_psyc_distress.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8000 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (10): sex, indigeneity, high_school, partnered, remoteness, language, sm...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="it-contains-the-following-variables" class="level4">
<h4 class="anchored" data-anchor-id="it-contains-the-following-variables">It contains the following variables:</h4>
<p>Sex: 0: Female; 1: Male<br>
Indigeneity: 0: non-indigenous; 1: indigenous<br>
High_school: 0: not completed high school; 1: completed high school<br>
Partnered: 0: not partnered; 1: partnered<br>
Remoteness: Remoteness of an individual’s residence, (“factor” variable). 0: major cities; 1: inner regional; 2: outer regional or more remote area<br>
Language: Main language of the participant. 0: non-English; 1: English<br>
Smoker: 0: No; 1: Yes<br>
Risky_alcohol: Consuming alcohol at a risky level. 0: No; 1: Yes<br>
Psyc_distress: Numeric variable ranged from 10 to 50. Higher value represents higher level of psychological distress<br>
Age: Age of the participant</p>
</section>
<section id="method-1-matching" class="level4">
<h4 class="anchored" data-anchor-id="method-1-matching">Method 1: Matching</h4>
<p>The goal of matching is to establish the balance between treatment and control group, as it generally is in RTCs. Specificly, it targets similar distributions of all observed covariates in both treatment and control group. A variant of matching is one-to-one matching which matches each individual in the treatment group with an individual in the control group based on a propensity score. This score represents the probability of receiving the treatment, measured by all variables that can influence it. It is often estimated using logistic regression with pretreatment covariates. Unmatched individuals will be excluded. After matching, the Average Treatment effect among the Treated (ATT) can now be calculated using simple regression.</p>
</section>
<section id="the-following-example-illustrates-estimating-the-causal-effect-of-smoking-on-psychological-distress" class="level4">
<h4 class="anchored" data-anchor-id="the-following-example-illustrates-estimating-the-causal-effect-of-smoking-on-psychological-distress">The following example illustrates estimating the causal effect of smoking on psychological distress:</h4>
<p>Primarily, all smokers need to be matched to a non-smoker from the control group.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>smk_matching <span class="ot">&lt;-</span> <span class="fu">matchit</span>(smoker <span class="sc">~</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">data =</span> smk_data, <span class="at">method =</span> <span class="st">"optimal"</span>, <span class="at">distance =</span> <span class="st">"glm"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_matching)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = smoker ~ sex + indigeneity + high_school + 
    partnered + remoteness + language + risky_alcohol + age, 
    data = smk_data, method = "optimal", distance = "glm")

Summary of Balance for All Data:
              Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance             0.1852        0.1130          0.6304     2.0778    0.2033
sex                  0.4938        0.4421          0.1035          .    0.0518
indigeneity          0.0524        0.0175          0.1565          .    0.0349
high_school          0.4220        0.6378         -0.4370          .    0.2158
partnered            0.4630        0.6913         -0.4578          .    0.2283
remoteness0          0.5852        0.6773         -0.1870          .    0.0921
remoteness1          0.2177        0.1900          0.0670          .    0.0277
remoteness2          0.1971        0.1327          0.1621          .    0.0645
language             0.9579        0.9130          0.2234          .    0.0449
risky_alcohol        0.6427        0.5411          0.2120          .    0.1016
age                 51.6057       53.7824         -0.1676     0.8214    0.0441
              eCDF Max
distance        0.3185
sex             0.0518
indigeneity     0.0349
high_school     0.2158
partnered       0.2283
remoteness0     0.0921
remoteness1     0.0277
remoteness2     0.0645
language        0.0449
risky_alcohol   0.1016
age             0.1020

Summary of Balance for Matched Data:
              Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance             0.1852        0.1849          0.0025     1.0151    0.0002
sex                  0.4938        0.5000         -0.0123          .    0.0062
indigeneity          0.0524        0.0400          0.0553          .    0.0123
high_school          0.4220        0.4127          0.0187          .    0.0092
partnered            0.4630        0.4743         -0.0226          .    0.0113
remoteness0          0.5852        0.6027         -0.0354          .    0.0175
remoteness1          0.2177        0.2136          0.0100          .    0.0041
remoteness2          0.1971        0.1838          0.0335          .    0.0133
language             0.9579        0.9620         -0.0205          .    0.0041
risky_alcohol        0.6427        0.6417          0.0021          .    0.0010
age                 51.6057       51.2064          0.0307     0.9137    0.0153
              eCDF Max Std. Pair Dist.
distance        0.0072          0.0044
sex             0.0062          0.2752
indigeneity     0.0123          0.3042
high_school     0.0092          0.1725
partnered       0.0113          0.1833
remoteness0     0.0175          0.2772
remoteness1     0.0041          0.2389
remoteness2     0.0133          0.3226
language        0.0041          0.1329
risky_alcohol   0.0010          0.2678
age             0.0390          0.3493

Sample Sizes:
          Control Treated
All          7026     974
Matched       974     974
Unmatched    6052       0
Discarded       0       0</code></pre>
</div>
</div>
</section>
<section id="to-highlight-the-difference-in-the-matched-and-unmatched-data-set-concerning-the-adjustment-of-all-social-demographic-variables" class="level4">
<h4 class="anchored" data-anchor-id="to-highlight-the-difference-in-the-matched-and-unmatched-data-set-concerning-the-adjustment-of-all-social-demographic-variables">To highlight the difference in the matched and unmatched data set concerning the adjustment of all social demographic variables:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">summary</span>(smk_matching), <span class="at">abs=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="to-estimate-the-the-treatment-effect-of-smoking-on-social-distress-a-linear-regression-is-used" class="level4">
<h4 class="anchored" data-anchor-id="to-estimate-the-the-treatment-effect-of-smoking-on-social-distress-a-linear-regression-is-used">To estimate the the treatment effect of smoking on social distress a linear regression is used:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(smk_matching)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>smk_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(psyc_distress <span class="sc">~</span> smoker, <span class="at">data =</span> matched_data, <span class="at">weights =</span> weights)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = psyc_distress ~ smoker, data = matched_data, weights = weights)

Residuals:
   Min     1Q Median     3Q    Max 
-7.313 -5.261 -2.261  2.700 34.739 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  15.2608     0.2155  70.826  &lt; 2e-16 ***
smoker        2.0524     0.3047   6.735 2.15e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.725 on 1946 degrees of freedom
Multiple R-squared:  0.02278,   Adjusted R-squared:  0.02228 
F-statistic: 45.36 on 1 and 1946 DF,  p-value: 2.147e-11</code></pre>
</div>
</div>
</section>
<section id="for-inference-the-results-we-need-to-calculate-the-cluster-robust-standard-error-and-the-corresponding-confidence-interval" class="level4">
<h4 class="anchored" data-anchor-id="for-inference-the-results-we-need-to-calculate-the-cluster-robust-standard-error-and-the-corresponding-confidence-interval">For inference the results we need to calculate the cluster-robust standard error and the corresponding confidence interval:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(smk_model1, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

            Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept) 15.26078    0.18357 83.1352 &lt; 2.2e-16 ***
smoker       2.05236    0.29287  7.0077 3.326e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(smk_model1, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                2.5 %    97.5 %
(Intercept) 14.900774 15.620787
smoker       1.477986  2.626737</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>smk_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(psyc_distress <span class="sc">~</span> smoker <span class="sc">+</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">data =</span> matched_data, <span class="at">weights =</span> weights)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = psyc_distress ~ smoker + sex + indigeneity + high_school + 
    partnered + remoteness + language + risky_alcohol + age, 
    data = matched_data, weights = weights)

Residuals:
    Min      1Q  Median      3Q     Max 
-10.248  -4.406  -1.748   2.677  34.198 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   20.98300    1.02957  20.380  &lt; 2e-16 ***
smoker         2.05594    0.29643   6.936 5.49e-12 ***
sex           -0.84844    0.30543  -2.778  0.00553 ** 
indigeneity    0.71561    0.72464   0.988  0.32350    
high_school   -0.13068    0.31555  -0.414  0.67882    
partnered     -2.27879    0.30034  -7.587 5.04e-14 ***
remoteness1   -0.10904    0.37838  -0.288  0.77324    
remoteness2   -0.48268    0.40000  -1.207  0.22769    
language       0.31060    0.78642   0.395  0.69292    
risky_alcohol -0.04213    0.32257  -0.131  0.89609    
age           -0.08498    0.01169  -7.268 5.27e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.535 on 1937 degrees of freedom
Multiple R-squared:  0.08131,   Adjusted R-squared:  0.07657 
F-statistic: 17.14 on 10 and 1937 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(smk_model2, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)   20.983001   1.106654 18.9608 &lt; 2.2e-16 ***
smoker         2.055939   0.293548  7.0038 3.424e-12 ***
sex           -0.848438   0.309643 -2.7400  0.006199 ** 
indigeneity    0.715614   0.743268  0.9628  0.335771    
high_school   -0.130683   0.324392 -0.4029  0.687099    
partnered     -2.278793   0.301208 -7.5655 5.934e-14 ***
remoteness1   -0.109040   0.382795 -0.2849  0.775787    
remoteness2   -0.482682   0.409110 -1.1798  0.238210    
language       0.310598   0.908526  0.3419  0.732485    
risky_alcohol -0.042134   0.327350 -0.1287  0.897599    
age           -0.084981   0.011135 -7.6317 3.611e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(smk_model2, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   2.5 %      97.5 %
(Intercept)   18.8126422 23.15335935
smoker         1.4802364  2.63164188
sex           -1.4557070 -0.24116837
indigeneity   -0.7420744  2.17330331
high_school   -0.7668761  0.50551060
partnered     -2.8695187 -1.68806716
remoteness1   -0.8597748  0.64169401
remoteness2   -1.2850237  0.31965914
language      -1.4711929  2.09238922
risky_alcohol -0.6841293  0.59986187
age           -0.1068197 -0.06314286</code></pre>
</div>
</div>
</section>
<section id="method-2-inverse-probability-treatment-weighting" class="level4">
<h4 class="anchored" data-anchor-id="method-2-inverse-probability-treatment-weighting">Method 2: Inverse Probability Treatment Weighting</h4>
<p>Inverse Probability Weighting (IPW) is a statistical technique used in observational studies to estimate the causal effect of a treatment or intervention. Its primary objective is to address potential confounding variables and (like the matching method) achieve balance between the treatment and control groups. In IPW, propensity scores are calculated for each individual in the study population. These scores represent the probability of receiving the treatment, given a set of observed covariates, like in this case religion or education. Once the propensity scores are obtained, weights are assigned to each individual based on their propensity score. Individuals in the treatment group are assigned weights that are the inverse of their propensity score, while individuals in the control group are assigned weights derived from the inverse of one minus the propensity score. These weights help balance the groups by giving more weight to individuals who are less likely to receive the treatment, and vice versa. The weighted data is then used to estimate the causal effect of the treatment using appropriate statistical methods such as regression models or stratification techniques.</p>
</section>
<section id="balance-the-groups" class="level4">
<h4 class="anchored" data-anchor-id="balance-the-groups">Balance the groups:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Here starts the part for IPTW method. The same data is being used, with remoteness variable recoded as factor variable.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>smk_iptw <span class="ot">&lt;-</span> <span class="fu">ps</span>(smoker <span class="sc">~</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">interaction.depth =</span> <span class="dv">3</span>, <span class="at">data =</span> <span class="fu">as.data.frame</span>(smk_data), <span class="at">n.tree =</span> <span class="dv">5000</span>, <span class="at">estimand =</span> <span class="st">"ATE"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.table</span>(smk_iptw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$unw
               tx.mn  tx.sd  ct.mn  ct.sd std.eff.sz    stat  pval    ks
sex            0.494  0.500  0.442  0.497      0.104   3.031 0.002 0.052
indigeneity    0.052  0.223  0.018  0.131      0.239   4.770 0.000 0.035
high_school    0.422  0.494  0.638  0.481     -0.443 -12.820 0.000 0.216
partnered      0.463  0.499  0.691  0.462     -0.483 -13.504 0.000 0.228
remoteness:0   0.585  0.493  0.677  0.467     -0.195  19.793 0.000 0.092
remoteness:1   0.218  0.413  0.190  0.392      0.070      NA    NA 0.028
remoteness:2   0.197  0.398  0.133  0.339      0.186      NA    NA 0.064
language       0.958  0.201  0.913  0.282      0.164   6.180 0.000 0.045
risky_alcohol  0.643  0.479  0.541  0.498      0.204   6.169 0.000 0.102
age           51.606 12.990 53.782 14.333     -0.153  -4.839 0.000 0.102
              ks.pval
sex             0.020
indigeneity     0.250
high_school     0.000
partnered       0.000
remoteness:0    0.000
remoteness:1       NA
remoteness:2       NA
language        0.064
risky_alcohol   0.000
age             0.000

$ks.mean.ATE
               tx.mn  tx.sd  ct.mn  ct.sd std.eff.sz   stat  pval    ks ks.pval
sex            0.449  0.498  0.448  0.497      0.002  0.051 0.959 0.001   1.000
indigeneity    0.019  0.138  0.021  0.144     -0.012 -0.485 0.627 0.002   1.000
high_school    0.608  0.488  0.612  0.487     -0.009 -0.217 0.828 0.004   1.000
partnered      0.651  0.477  0.664  0.472     -0.028 -0.734 0.463 0.013   1.000
remoteness:0   0.668  0.471  0.667  0.471      0.003  0.003 0.997 0.001   0.997
remoteness:1   0.193  0.395  0.193  0.395     -0.001     NA    NA 0.000      NA
remoteness:2   0.139  0.346  0.140  0.347     -0.003     NA    NA 0.001      NA
language       0.929  0.257  0.918  0.274      0.039  0.847 0.397 0.011   1.000
risky_alcohol  0.572  0.495  0.554  0.497      0.037  0.862 0.389 0.018   0.992
age           53.293 13.857 53.525 14.194     -0.016 -0.373 0.709 0.016   0.999

$es.mean.ATE
               tx.mn  tx.sd  ct.mn  ct.sd std.eff.sz   stat  pval    ks ks.pval
sex            0.449  0.498  0.448  0.497      0.002  0.056 0.955 0.001   1.000
indigeneity    0.020  0.138  0.021  0.144     -0.012 -0.467 0.640 0.002   1.000
high_school    0.608  0.488  0.612  0.487     -0.008 -0.215 0.830 0.004   1.000
partnered      0.650  0.477  0.664  0.472     -0.029 -0.757 0.449 0.014   1.000
remoteness:0   0.667  0.471  0.667  0.471      0.002  0.003 0.997 0.001   0.997
remoteness:1   0.193  0.395  0.193  0.395      0.000     NA    NA 0.000      NA
remoteness:2   0.139  0.346  0.140  0.347     -0.003     NA    NA 0.001      NA
language       0.929  0.257  0.918  0.274      0.039  0.847 0.397 0.011   1.000
risky_alcohol  0.572  0.495  0.554  0.497      0.037  0.870 0.384 0.018   0.991
age           53.296 13.859 53.525 14.194     -0.016 -0.368 0.713 0.016   0.999</code></pre>
</div>
</div>
<p>The ps()-function is being used to estimate the propensity scores. The variable smoker is the outcome variable, and the other variables listed are the predictors used to predict the likelihood of being a smoker (Receiving the Treatment). The result is stored in the smk_iptw object, which can then be further used for estimating the causal effect of the treatment on smoking behavior.</p>
<p>The command “bal.table(smk_iptw)” calculates a balance table for the variables in relation to the created propensity score model “smk_iptw”. In this case, the focus is on the first and third table and on the column “std. eff. sz”. In the first table, there are substantial differences in all variables in the original data between the two groups (&gt; 0.1). Compared to that, in the third table, which represents the weighted data, the differences are close to 0. So a much better balance between the groups regarding the covariates is achieved.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(smk_iptw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="extract-the-weights" class="level4">
<h4 class="anchored" data-anchor-id="extract-the-weights">Extract the weights:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract the weights</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>smk_data<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">get.weights</span>(smk_iptw, <span class="at">stop.method =</span> <span class="st">"es.mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>With the previous step, the weights can now be extracted. The get.weights()-function is used to calculate the weights for the observations based on the propensity score analysis. The relevant object was defined above as smk_iptw. This object contains the necessary information to compute the weights. By executing this code, the propensity score weights are calculated for each observation in the “smk_data” dataset and stored in the newly created “weight” variable.</p>
</section>
<section id="estimate-the-treatment-effect" class="level4">
<h4 class="anchored" data-anchor-id="estimate-the-treatment-effect">Estimate the Treatment Effect:</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimate the Treatment Effect</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>design_iptw <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>weight, <span class="at">data =</span> smk_data)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>smk_model3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(psyc_distress <span class="sc">~</span> smoker, <span class="at">design =</span> design_iptw)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = psyc_distress ~ smoker, design = design_iptw)

Survey design:
svydesign(ids = ~1, weights = ~weight, data = smk_data)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.83600    0.06618 224.168  &lt; 2e-16 ***
smoker       1.72865    0.25771   6.708 2.11e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 38.62049)

Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
<p>After using IPTW, the Treatment Effect can now be estimated. The function svyglm() estimates a generalized linear model (glm) for psychological distress (psyc_distress) based on the variable smoker. The model is fitted using the previously created survey design design_iptw with inverse probability weighting. The results of the model are assigned to the variable smk_model3. The following summary ()-function provides the results from the smk_model3. It includes statistical information such as estimates, standard errors, p-values, and confidence intervals for the estimated model coefficients. By running these code snippets, estimates, summaries, and confidence intervals are computed for the relationship between smoking and psychological distress. The results can be used to analyze the impact of smoking on mental health and draw conclusions. By using Inverse Probability Weighting before, we got a much better estimate for the causal relationship between smoking and psychological distress by migate the impact of the confounding variables and create balance between treatment and control group.</p>
<p>In this case, the analysis estimates that smoking leads to an increase of 1.73 points in psychological distress compared to non-smokers.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(smk_model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                2.5 %    97.5 %
(Intercept) 14.706263 14.965732
smoker       1.223468  2.233829</code></pre>
</div>
</div>
</section>
</section>
<section id="in-this-part-the-effect-of-the-minimum-alcohol-pricing-on-alcohol-consumption-at-the-population-level-is-estimated-in-northern-territory-australia-using-interrupted-time-series-analysis." class="level3">
<h3 class="anchored" data-anchor-id="in-this-part-the-effect-of-the-minimum-alcohol-pricing-on-alcohol-consumption-at-the-population-level-is-estimated-in-northern-territory-australia-using-interrupted-time-series-analysis.">In this part, the effect of the minimum alcohol pricing on alcohol consumption at the population level is estimated in Northern Territory, Australia, using interrupted time series analysis.</h3>
</section>
<section id="the-dataset-contains-5-variables" class="level3">
<h3 class="anchored" data-anchor-id="the-dataset-contains-5-variables">The dataset contains 5 variables</h3>
<p>alcohol: measure of population level alcohol consumption in a month. time: time measures in months state: “NT”: Northern Territory; “WA” Western Australia intervention: Whether the time point is pre or post intervention. 0: Pre-intervention; 1: Post-intervention. season: Season of the year. 1: Spring; 2: Summer; 3: Autumn; 4: Winter</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load the dataset</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://statsnotebook.io/blog/data_management/example_data/alcohol_data_NTWA.csv"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#state and intervention variables are being converted into factor.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">factor</span>(alc_mup_data<span class="sc">$</span>state, <span class="at">exclude =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="cn">NA</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>intervention <span class="ot">&lt;-</span> <span class="fu">factor</span>(alc_mup_data<span class="sc">$</span>intervention, <span class="at">exclude =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="cn">NA</span>))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#relevel() function is being used to set the reference level of the state variable to be “WA” (Western Australia).</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">relevel</span>(alc_mup_data<span class="sc">$</span>state, <span class="at">ref=</span><span class="st">"WA"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#the descriptive statistics can be generated by states and by pre/post intervention.</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, intervention) <span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">M_alcohol =</span> <span class="fu">mean</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">Mdn_alcohol =</span> <span class="fu">median</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">SD_alcohol =</span> <span class="fu">sd</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">IQR_alcohol =</span> <span class="fu">IQR</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
# Groups:   state [2]
  state intervention count M_alcohol Mdn_alcohol SD_alcohol IQR_alcohol
  &lt;fct&gt; &lt;fct&gt;        &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
1 WA    0               24     1531.       1587.       358.        506.
2 WA    1               24     1582.       1583.       367.        517.
3 NT    0               24     3444.       3548.       349.        388.
4 NT    1               24     1777.       1748.       323.        324.</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Here the ggplot() function is being used to visualize alcohol consumption level by state and by pre/post intervention.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(alc_mup_data) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>alcohol, <span class="at">x=</span>state, <span class="at">fill =</span> intervention))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="the-descriptive-analysis-suggests-that-alcohol-minimum-pricing-likely-reduced-alcohol-consumption-in-the-population-in-nt." class="level4">
<h4 class="anchored" data-anchor-id="the-descriptive-analysis-suggests-that-alcohol-minimum-pricing-likely-reduced-alcohol-consumption-in-the-population-in-nt.">The descriptive analysis suggests that alcohol minimum pricing likely reduced alcohol consumption in the population (in NT).</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimating the intervention effect of alcohol minimum pricing on population level alcohol consumption, using gls() function</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gls</span>(alcohol <span class="sc">~</span> time<span class="sc">*</span>intervention<span class="sc">*</span>state,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> alc_mup_data,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">form =</span><span class="sc">~</span> time <span class="sc">|</span> state), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: alcohol ~ time * intervention * state 
  Data: alc_mup_data 
       AIC      BIC    logLik
  1330.261 1355.905 -655.1307

Correlation Structure: AR(1)
 Formula: ~time | state 
 Parameter estimate(s):
      Phi 
0.7066424 

Coefficients:
                               Value Std.Error   t-value p-value
(Intercept)                 1558.506  263.2032  5.921303  0.0000
time                           1.636   16.9157  0.096720  0.9232
intervention1                -20.840  715.1188 -0.029143  0.9768
stateNT                     2133.915  372.2256  5.732854  0.0000
time:intervention1            -1.221   27.5750 -0.044281  0.9648
time:stateNT                 -23.652   23.9224 -0.988718  0.3255
intervention1:stateNT      -3258.232 1011.3307 -3.221728  0.0018
time:intervention1:stateNT    62.170   38.9969  1.594227  0.1145

 Correlation: 
                           (Intr) time   intrv1 statNT tm:nt1 tm:sNT in1:NT
time                       -0.840                                          
intervention1              -0.507  0.639                                   
stateNT                    -0.707  0.594  0.358                            
time:intervention1          0.600 -0.815 -0.945 -0.424                     
time:stateNT                0.594 -0.707 -0.452 -0.840  0.576              
intervention1:stateNT       0.358 -0.452 -0.707 -0.507  0.668  0.639       
time:intervention1:stateNT -0.424  0.576  0.668  0.600 -0.707 -0.815 -0.945

Standardized residuals:
       Min         Q1        Med         Q3        Max 
-2.3167349 -0.8427548  0.0837754  0.6497867  2.4752763 

Residual standard error: 312.3269 
Degrees of freedom: 96 total; 88 residual</code></pre>
</div>
</div>
</section>
<section id="while-alcohol-consumption-in-the-northern-territory-was-higher-than-in-western-australia-before-alcohol-minimum-pricing-there-was-no-significant-difference-in-the-pre-intervention-trend-as-indicated-by-the-time-by-state-interaction.-immediately-after-implementing-minimum-alcohol-price-there-was-a-significant-drop-in-alcohol-consumption-in-the-northern-territory-but-not-in-western-australia-as-indicated-by-the-intervention-by-state-interaction." class="level4">
<h4 class="anchored" data-anchor-id="while-alcohol-consumption-in-the-northern-territory-was-higher-than-in-western-australia-before-alcohol-minimum-pricing-there-was-no-significant-difference-in-the-pre-intervention-trend-as-indicated-by-the-time-by-state-interaction.-immediately-after-implementing-minimum-alcohol-price-there-was-a-significant-drop-in-alcohol-consumption-in-the-northern-territory-but-not-in-western-australia-as-indicated-by-the-intervention-by-state-interaction.">While alcohol consumption in the Northern Territory was higher than in Western Australia before alcohol minimum pricing, there was no significant difference in the pre-intervention trend (as indicated by the time by state interaction). Immediately after implementing minimum alcohol price, there was a significant drop in alcohol consumption in the Northern Territory but not in Western Australia (as indicated by the intervention by state interaction).</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generating the model-based prediction</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> res<span class="sc">$</span>fitted</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#generating the interaction for ggplots</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">interaction</span>(alc_mup_data<span class="sc">$</span>intervention,alc_mup_data<span class="sc">$</span>state)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ploting the time series</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> alcohol, <span class="at">x =</span> time, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> time, <span class="at">color =</span> state, <span class="at">group =</span> groups)) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>((alc_mup_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intervention <span class="sc">==</span> <span class="st">"0"</span>))<span class="sc">$</span>time), <span class="at">linetype =</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"sans"</span>) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Autocorrelation refers to the correlation between a time series variable and its own lagged values. In other terms, it measures how a variable is related to its past values and is a way to assess if there is a pattern or dependency within a time series. Lags, on the other hand, refer to the time intervals between the current observation and its past observations. By introducing lags, you can compare the value of a variable at a specific time point with its values at previous time points.</p>
<p>The model has accounted for lag-1 autocorrelation. The sufficiency can be evaluated using the partial auto-correlation function. In this analysis, the auto-correlation function for Western Australia and Northern Territory need to be plotted separately.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract the residuals</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(res)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plotting the partial ACF</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(alc_mup_data[alc_mup_data<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"NT"</span>,]<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(alc_mup_data[alc_mup_data<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"WA"</span>,]<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Both PACF plots suggest that it should be adjusted for up to the lag-4 auto-correlation.The analysis can be rerun by setting the p parameter to 4.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(alcohol <span class="sc">~</span> time<span class="sc">*</span>intervention<span class="sc">*</span>state,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> alc_mup_data,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">4</span>, <span class="at">form =</span><span class="sc">~</span> time <span class="sc">|</span> state), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: alcohol ~ time * intervention * state 
  Data: alc_mup_data 
       AIC      BIC    logLik
  1304.056 1337.393 -639.0282

Correlation Structure: ARMA(4,0)
 Formula: ~time | state 
 Parameter estimate(s):
       Phi1        Phi2        Phi3        Phi4 
 0.62015477  0.16715567 -0.07317626 -0.39203575 

Coefficients:
                               Value Std.Error   t-value p-value
(Intercept)                 1658.724  132.8975 12.481222  0.0000
time                          -8.569    9.0656 -0.945170  0.3472
intervention1                264.793  363.4460  0.728561  0.4682
stateNT                     2066.230  187.9455 10.993769  0.0000
time:intervention1            -1.092   13.2700 -0.082299  0.9346
time:stateNT                 -14.494   12.8208 -1.130523  0.2613
intervention1:stateNT      -3441.397  513.9903 -6.695452  0.0000
time:intervention1:stateNT    58.177   18.7666  3.100037  0.0026

 Correlation: 
                           (Intr) time   intrv1 statNT tm:nt1 tm:sNT in1:NT
time                       -0.894                                          
intervention1              -0.417  0.394                                   
stateNT                    -0.707  0.632  0.295                            
time:intervention1          0.647 -0.732 -0.895 -0.458                     
time:stateNT                0.632 -0.707 -0.279 -0.894  0.518              
intervention1:stateNT       0.295 -0.279 -0.707 -0.417  0.633  0.394       
time:intervention1:stateNT -0.458  0.518  0.633  0.647 -0.707 -0.732 -0.895

Standardized residuals:
       Min         Q1        Med         Q3        Max 
-2.2969668 -0.7601198  0.1152635  0.7156477  2.3217466 

Residual standard error: 310.0007 
Degrees of freedom: 96 total; 88 residual</code></pre>
</div>
</div>
<p>Adjusting for seasonality using harmonic function</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The harmonic function is used to calculate the harmonic terms calculate based on sine and cosine function</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the first parameter of this function specifies the time variable</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#the second specifies the number of sine and cosine pairs to include</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#the third specifies the length of the period</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(alc_mup_data, <span class="fu">data.frame</span>(<span class="fu">harmonic</span>(alc_mup_data<span class="sc">$</span>time, <span class="dv">1</span>, <span class="dv">12</span>)))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="ot">&lt;-</span> alc_mup_data <span class="sc">%&gt;%</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">harmonic1 =</span> X1,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">harmonic2 =</span> X2)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gls</span>(alcohol <span class="sc">~</span> time<span class="sc">*</span>intervention<span class="sc">*</span>state <span class="sc">+</span> harmonic1 <span class="sc">+</span> harmonic2,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> alc_mup_data,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">form =</span><span class="sc">~</span> time <span class="sc">|</span> state), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by maximum likelihood
  Model: alcohol ~ time * intervention * state + harmonic1 + harmonic2 
  Data: alc_mup_data 
      AIC      BIC   logLik
  1313.75 1344.522 -644.875

Correlation Structure: AR(1)
 Formula: ~time | state 
 Parameter estimate(s):
      Phi 
0.6162917 

Coefficients:
                               Value Std.Error   t-value p-value
(Intercept)                 1665.579  197.7979  8.420607  0.0000
time                          -7.244   13.0538 -0.554900  0.5804
intervention1                142.751  541.7217  0.263513  0.7928
stateNT                     2146.874  277.3498  7.740673  0.0000
harmonic1                   -267.374   57.3382 -4.663114  0.0000
harmonic2                    -27.005   53.3816 -0.505882  0.6142
time:intervention1             0.474   20.4244  0.023186  0.9816
time:stateNT                 -22.924   18.2655 -1.255060  0.2129
intervention1:stateNT      -3284.316  762.7561 -4.305853  0.0000
time:intervention1:stateNT    61.114   28.8323  2.119624  0.0369

 Correlation: 
                           (Intr) time   intrv1 statNT hrmnc1 hrmnc2 tm:nt1
time                       -0.853                                          
intervention1              -0.468  0.540                                   
stateNT                    -0.701  0.595  0.338                            
harmonic1                  -0.128  0.145 -0.060  0.000                     
harmonic2                  -0.017  0.007  0.074  0.000 -0.041              
time:intervention1          0.609 -0.782 -0.924 -0.432 -0.014 -0.058       
time:stateNT                0.596 -0.700 -0.391 -0.850  0.000  0.000  0.557
intervention1:stateNT       0.336 -0.389 -0.704 -0.480  0.000  0.000  0.654
time:intervention1:stateNT -0.429  0.552  0.652  0.612  0.000  0.000 -0.706
                           tm:sNT in1:NT
time                                    
intervention1                           
stateNT                                 
harmonic1                               
harmonic2                               
time:intervention1                      
time:stateNT                            
intervention1:stateNT       0.556       
time:intervention1:stateNT -0.789 -0.926

Standardized residuals:
       Min         Q1        Med         Q3        Max 
-2.8783266 -0.7063188 -0.1231168  0.6723216  1.9645475 

Residual standard error: 252.7503 
Degrees of freedom: 96 total; 86 residual</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the predicted value</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> res<span class="sc">$</span>fitted</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">interaction</span>(alc_mup_data<span class="sc">$</span>intervention,alc_mup_data<span class="sc">$</span>state)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the predicted linear trend for data visualisation</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear <span class="ot">&lt;-</span> alc_mup_data</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear<span class="sc">$</span>harmonic1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear<span class="sc">$</span>harmonic2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(res, alc_mup_data.linear)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the time series</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> alcohol, <span class="at">x =</span> time, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> time, <span class="at">color =</span> state, <span class="at">group =</span> groups), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> alc_mup_data.linear, <span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> time, <span class="at">color =</span> state, <span class="at">group =</span> groups)) <span class="sc">+</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>((alc_mup_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intervention <span class="sc">==</span> <span class="st">"0"</span>))<span class="sc">$</span>time), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"sans"</span>) <span class="sc">+</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="example_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="results-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="results-interpretation">Results &amp; Interpretation</h3>
<p>In conclusion, we have explored three powerful methods in causal inference which are part of the case study “Causal inference with observational data in addiction research”: Matching, Inverse Probability Treatment Weighting (IPTW), and Time Series Analysis. Each of these methods offers unique approaches to address causal questions in observational data. To explain Matching and IPTW the used study investigates the causal effect of smoking on psychological distress.</p>
<p>We saw, that Matching is a valuable technique that aims to create comparable treatment and control groups by pairing observations based on their similarity in propensity scores. IPTW assigning weights to observations based on their propensity scores, effectively balancing treatment and control groups. So these two methods have the same goal by creating balance between treatment and control group und thereafter on that base estimating the Average Treatment Effect.</p>
<p>Time Series Analysis, on the other hand, allows us to explore the dynamics and relationships among variables over time. It provides insights into the causal effects of interventions or treatments by examining how changes in one variable influence another variable in a time-dependent manner.</p>
<p>In summary, by employing Inverse Probability Weighting, Matching, and Time Series Analysis, researchers can enhance their ability to understand and estimate causal effects in diverse settings, contributing to evidence-based decision-making and advancing our understanding of complex phenomena.</p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "DCL Real Data Example: Addiction Research"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Mattes Grundmann, Oya Bazer, Jakob Zschocke"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-06-07"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">### Introduction:</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>While Randomized Controlled Trials (RCTs) are the gold standard for causal inference, these are often not feasible in addiction research for ethical and logistic reasons; for example, when studying the impact of smoking on cancer.</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>Instead, observational data from real-world settings are increasingly being used to inform clinical decisions and public health policies. This paper presents the framework for potential outcomes for causal inference and summarizes best practices in causal analysis for observational data. Among them: Matching, Inverse Probability Weighting (IPW), and Interrupted Time-Series Analysis (ITSA).</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>These methods will be explained using examples from addiction research, and the resulting results will be compared.</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Required packages and libraries:</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE,warning = FALSE}</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=tidyverse"</span>)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"lmtest"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=lmtest"</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"sandwich"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=sandwich"</span>)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"MatchIt"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=MatchIt"</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"twang"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=twang"</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"nlme"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=nlme"</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=ggplot2"</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tsModel"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">repos =</span> <span class="st">"https://CRAN.R-project.org/package=tsModel"</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE,warning = FALSE}</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt) </span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(twang)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsModel)</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The methods Matching and IPTW will be explained on the basis of the following (observational) data set:</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>smk_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/gckc123/Causal_Analysis_Addiction_Examples/main/smoking_psyc_distress.csv"</span>)</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="fu">#### It contains the following variables:</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>Sex: 0: Female; 1: Male\</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>Indigeneity: 0: non-indigenous; 1: indigenous\</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>High_school: 0: not completed high school; 1: completed high school\</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>Partnered: 0: not partnered; 1: partnered\</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>Remoteness: Remoteness of an individual's residence, ("factor" variable). 0: major cities; 1: inner regional; 2: outer regional or more remote area\</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>Language: Main language of the participant. 0: non-English; 1: English\</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>Smoker: 0: No; 1: Yes\</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>Risky_alcohol: Consuming alcohol at a risky level. 0: No; 1: Yes\</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>Psyc_distress: Numeric variable ranged from 10 to 50. Higher value represents higher level of psychological distress\</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>Age: Age of the participant</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>smk_data<span class="sc">$</span>remoteness <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(smk_data<span class="sc">$</span>remoteness)</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Method 1: Matching</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>The goal of matching is to establish the balance between treatment and control group, as it generally is in RTCs. Specificly, it targets similar distributions of all observed covariates in both treatment and control group. A variant of matching is one-to-one matching which matches each individual in the treatment group with an individual in the control group based on a propensity score. This score represents the probability of receiving the treatment, measured by all variables that can influence it. It is often estimated using logistic regression with pretreatment covariates. Unmatched individuals will be excluded. After matching, the Average Treatment effect among the Treated (ATT) can now be calculated using simple regression.</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The following example illustrates estimating the causal effect of smoking on psychological distress:</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>Primarily, all smokers need to be matched to a non-smoker from the control group.</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>smk_matching <span class="ot">&lt;-</span> <span class="fu">matchit</span>(smoker <span class="sc">~</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">data =</span> smk_data, <span class="at">method =</span> <span class="st">"optimal"</span>, <span class="at">distance =</span> <span class="st">"glm"</span>)</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_matching)</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a><span class="fu">#### To highlight the difference in the matched and unmatched data set concerning the adjustment of all social demographic variables:</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">summary</span>(smk_matching), <span class="at">abs=</span><span class="cn">FALSE</span>)</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a><span class="fu">#### To estimate the the treatment effect of smoking on social distress a linear regression is used:</span></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(smk_matching)</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>smk_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(psyc_distress <span class="sc">~</span> smoker, <span class="at">data =</span> matched_data, <span class="at">weights =</span> weights)</span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model1)</span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a><span class="fu">#### For inference the results we need to calculate the cluster-robust standard error and the corresponding confidence interval:</span></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(smk_model1, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass)</span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(smk_model1, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass, <span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a>smk_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(psyc_distress <span class="sc">~</span> smoker <span class="sc">+</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">data =</span> matched_data, <span class="at">weights =</span> weights)</span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model2)</span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(smk_model2, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass)</span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(smk_model2, <span class="at">vcov. =</span> vcovCL, <span class="at">cluster =</span> <span class="sc">~</span>subclass, <span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Method 2: Inverse Probability Treatment Weighting</span></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a>Inverse Probability Weighting (IPW) is a statistical technique used in observational studies to estimate the causal effect of a treatment or intervention. Its primary objective is to address potential confounding variables and (like the matching method) achieve balance between the treatment and control groups. In IPW, propensity scores are calculated for each individual in the study population. These scores represent the probability of receiving the treatment, given a set of observed covariates, like in this case religion or education. Once the propensity scores are obtained, weights are assigned to each individual based on their propensity score. Individuals in the treatment group are assigned weights that are the inverse of their propensity score, while individuals in the control group are assigned weights derived from the inverse of one minus the propensity score. These weights help balance the groups by giving more weight to individuals who are less likely to receive the treatment, and vice versa. The weighted data is then used to estimate the causal effect of the treatment using appropriate statistical methods such as regression models or stratification techniques.</span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Balance the groups:</span></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a><span class="co">#Here starts the part for IPTW method. The same data is being used, with remoteness variable recoded as factor variable.</span></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>smk_iptw <span class="ot">&lt;-</span> <span class="fu">ps</span>(smoker <span class="sc">~</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">interaction.depth =</span> <span class="dv">3</span>, <span class="at">data =</span> <span class="fu">as.data.frame</span>(smk_data), <span class="at">n.tree =</span> <span class="dv">5000</span>, <span class="at">estimand =</span> <span class="st">"ATE"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.table</span>(smk_iptw)</span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a>The ps()-function is being used to estimate the propensity scores. The variable smoker is the outcome variable, and the other variables listed are the predictors used to predict the likelihood of being a smoker (Receiving the Treatment). The result is stored in the smk_iptw object, which can then be further used for estimating the causal effect of the treatment on smoking behavior.</span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a>The command "bal.table(smk_iptw)" calculates a balance table for the variables in relation to the created propensity score model "smk_iptw". In this case, the focus is on the first and third table and on the column "std. eff. sz". In the first table, there are substantial differences in all variables in the original data between the two groups (<span class="sc">\&gt;</span> 0.1). Compared to that, in the third table, which represents the weighted data, the differences are close to 0. So a much better balance between the groups regarding the covariates is achieved.</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(smk_iptw)</span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Extract the weights:</span></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a><span class="co">#extract the weights</span></span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a>smk_data<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">get.weights</span>(smk_iptw, <span class="at">stop.method =</span> <span class="st">"es.mean"</span>)</span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a>With the previous step, the weights can now be extracted. The get.weights()-function is used to calculate the weights for the observations based on the propensity score analysis. The relevant object was defined above as smk_iptw. This object contains the necessary information to compute the weights. By executing this code, the propensity score weights are calculated for each observation in the "smk_data" dataset and stored in the newly created "weight" variable.</span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Estimate the Treatment Effect:</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimate the Treatment Effect</span></span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a>design_iptw <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>weight, <span class="at">data =</span> smk_data)</span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a>smk_model3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(psyc_distress <span class="sc">~</span> smoker, <span class="at">design =</span> design_iptw)</span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model3)</span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a>After using IPTW, the Treatment Effect can now be estimated. The function svyglm() estimates a generalized linear model (glm) for psychological distress (psyc_distress) based on the variable smoker. The model is fitted using the previously created survey design design_iptw with inverse probability weighting. The results of the model are assigned to the variable smk_model3. The following summary ()-function provides the results from the smk_model3. It includes statistical information such as estimates, standard errors, p-values, and confidence intervals for the estimated model coefficients. By running these code snippets, estimates, summaries, and confidence intervals are computed for the relationship between smoking and psychological distress. The results can be used to analyze the impact of smoking on mental health and draw conclusions. By using Inverse Probability Weighting before, we got a much better estimate for the causal relationship between smoking and psychological distress by migate the impact of the confounding variables and create balance between treatment and control group.</span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>In this case, the analysis estimates that smoking leads to an increase of 1.73 points in psychological distress compared to non-smokers.</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(smk_model3)</span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a><span class="co">#doubly robust estimation</span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a>smk_model4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(psyc_distress <span class="sc">~</span> smoker <span class="sc">+</span> sex <span class="sc">+</span> indigeneity <span class="sc">+</span> high_school <span class="sc">+</span> partnered <span class="sc">+</span> remoteness <span class="sc">+</span> language <span class="sc">+</span> risky_alcohol <span class="sc">+</span> age, <span class="at">design =</span> design_iptw)</span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smk_model4)</span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(smk_model4)</span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a><span class="fu">### In this part, the effect of the minimum alcohol pricing on alcohol consumption at the population level is estimated in Northern Territory, Australia, using interrupted time series analysis.</span></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### The dataset contains 5 variables</span></span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a>alcohol: measure of population level alcohol consumption in a month. time: time measures in months state: "NT": Northern Territory; "WA" Western Australia intervention: Whether the time point is pre or post intervention. 0: Pre-intervention; 1: Post-intervention. season: Season of the year. 1: Spring; 2: Summer; 3: Autumn; 4: Winter</span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE, warning = FALSE}</span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a><span class="co">#load the dataset</span></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://statsnotebook.io/blog/data_management/example_data/alcohol_data_NTWA.csv"</span>)</span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a><span class="co">#state and intervention variables are being converted into factor.</span></span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">factor</span>(alc_mup_data<span class="sc">$</span>state, <span class="at">exclude =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="cn">NA</span>))</span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>intervention <span class="ot">&lt;-</span> <span class="fu">factor</span>(alc_mup_data<span class="sc">$</span>intervention, <span class="at">exclude =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="cn">NA</span>))</span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a><span class="co">#relevel() function is being used to set the reference level of the state variable to be “WA” (Western Australia).</span></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">relevel</span>(alc_mup_data<span class="sc">$</span>state, <span class="at">ref=</span><span class="st">"WA"</span>)</span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="co">#the descriptive statistics can be generated by states and by pre/post intervention.</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="sc">%&gt;%</span></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, intervention) <span class="sc">%&gt;%</span></span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a>            <span class="at">M_alcohol =</span> <span class="fu">mean</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a>            <span class="at">Mdn_alcohol =</span> <span class="fu">median</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a>            <span class="at">SD_alcohol =</span> <span class="fu">sd</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a>            <span class="at">IQR_alcohol =</span> <span class="fu">IQR</span>(alcohol, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a><span class="co">#Here the ggplot() function is being used to visualize alcohol consumption level by state and by pre/post intervention.</span></span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(alc_mup_data) <span class="sc">+</span></span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>alcohol, <span class="at">x=</span>state, <span class="at">fill =</span> intervention))</span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The descriptive analysis suggests that alcohol minimum pricing likely reduced alcohol consumption in the population (in NT).</span></span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a><span class="co">#estimating the intervention effect of alcohol minimum pricing on population level alcohol consumption, using gls() function</span></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gls</span>(alcohol <span class="sc">~</span> time<span class="sc">*</span>intervention<span class="sc">*</span>state,</span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> alc_mup_data,</span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>           <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">form =</span><span class="sc">~</span> time <span class="sc">|</span> state), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a><span class="fu">#### While alcohol consumption in the Northern Territory was higher than in Western Australia before alcohol minimum pricing, there was no significant difference in the pre-intervention trend (as indicated by the time by state interaction). Immediately after implementing minimum alcohol price, there was a significant drop in alcohol consumption in the Northern Territory but not in Western Australia (as indicated by the intervention by state interaction).</span></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a><span class="co">#generating the model-based prediction</span></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> res<span class="sc">$</span>fitted</span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a><span class="co">#generating the interaction for ggplots</span></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">interaction</span>(alc_mup_data<span class="sc">$</span>intervention,alc_mup_data<span class="sc">$</span>state)</span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a><span class="co">#ploting the time series</span></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> alcohol, <span class="at">x =</span> time, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> time, <span class="at">color =</span> state, <span class="at">group =</span> groups)) <span class="sc">+</span></span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>((alc_mup_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intervention <span class="sc">==</span> <span class="st">"0"</span>))<span class="sc">$</span>time), <span class="at">linetype =</span> </span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a>               <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"sans"</span>) <span class="sc">+</span></span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a>Autocorrelation refers to the correlation between a time series variable and its own lagged values. In other terms, it measures how a variable is related to its past values and is a way to assess if there is a pattern or dependency within a time series. Lags, on the other hand, refer to the time intervals between the current observation and its past observations. By introducing lags, you can compare the value of a variable at a specific time point with its values at previous time points.</span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a>The model has accounted for lag-1 autocorrelation. The sufficiency can be evaluated using the partial auto-correlation function. In this analysis, the auto-correlation function for Western Australia and Northern Territory need to be plotted separately.</span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a><span class="co">#extract the residuals</span></span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(res)</span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a><span class="co">#plotting the partial ACF</span></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(alc_mup_data[alc_mup_data<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"NT"</span>,]<span class="sc">$</span>residuals)</span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(alc_mup_data[alc_mup_data<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"WA"</span>,]<span class="sc">$</span>residuals)</span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a>Both PACF plots suggest that it should be adjusted for up to the lag-4 auto-correlation.The analysis can be rerun by setting the p parameter to 4.</span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(alcohol <span class="sc">~</span> time<span class="sc">*</span>intervention<span class="sc">*</span>state,</span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> alc_mup_data,</span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a>            <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">4</span>, <span class="at">form =</span><span class="sc">~</span> time <span class="sc">|</span> state), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res2)</span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a>Adjusting for seasonality using harmonic function</span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a><span class="co">#The harmonic function is used to calculate the harmonic terms calculate based on sine and cosine function</span></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a><span class="co">#the first parameter of this function specifies the time variable</span></span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a><span class="co">#the second specifies the number of sine and cosine pairs to include</span></span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a><span class="co">#the third specifies the length of the period</span></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(alc_mup_data, <span class="fu">data.frame</span>(<span class="fu">harmonic</span>(alc_mup_data<span class="sc">$</span>time, <span class="dv">1</span>, <span class="dv">12</span>)))</span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a>alc_mup_data <span class="ot">&lt;-</span> alc_mup_data <span class="sc">%&gt;%</span> </span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">harmonic1 =</span> X1,</span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a>         <span class="at">harmonic2 =</span> X2)</span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gls</span>(alcohol <span class="sc">~</span> time<span class="sc">*</span>intervention<span class="sc">*</span>state <span class="sc">+</span> harmonic1 <span class="sc">+</span> harmonic2,</span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> alc_mup_data,</span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>           <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">form =</span><span class="sc">~</span> time <span class="sc">|</span> state), <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the predicted value</span></span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a>alc_mup_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> res<span class="sc">$</span>fitted</span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">interaction</span>(alc_mup_data<span class="sc">$</span>intervention,alc_mup_data<span class="sc">$</span>state)</span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the predicted linear trend for data visualisation</span></span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear <span class="ot">&lt;-</span> alc_mup_data</span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear<span class="sc">$</span>harmonic1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear<span class="sc">$</span>harmonic2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a>alc_mup_data.linear<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(res, alc_mup_data.linear)</span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the time series</span></span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> alcohol, <span class="at">x =</span> time, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> alc_mup_data, <span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> time, <span class="at">color =</span> state, <span class="at">group =</span> groups), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> alc_mup_data.linear, <span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> time, <span class="at">color =</span> state, <span class="at">group =</span> groups)) <span class="sc">+</span></span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>((alc_mup_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intervention <span class="sc">==</span> <span class="st">"0"</span>))<span class="sc">$</span>time), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"sans"</span>) <span class="sc">+</span></span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a><span class="fu">### Results &amp; Interpretation</span></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a>In conclusion, we have explored three powerful methods in causal inference which are part of the case study "Causal inference with observational data in addiction research": Matching, Inverse Probability Treatment Weighting (IPTW), and Time Series Analysis. Each of these methods offers unique approaches to address causal questions in observational data. To explain Matching and IPTW the used study investigates the causal effect of smoking on psychological distress.</span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a>We saw, that Matching is a valuable technique that aims to create comparable treatment and control groups by pairing observations based on their similarity in propensity scores. IPTW assigning weights to observations based on their propensity scores, effectively balancing treatment and control groups. So these two methods have the same goal by creating balance between treatment and control group und thereafter on that base estimating the Average Treatment Effect.</span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a>Time Series Analysis, on the other hand, allows us to explore the dynamics and relationships among variables over time. It provides insights into the causal effects of interventions or treatments by examining how changes in one variable influence another variable in a time-dependent manner.</span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a>In summary, by employing Inverse Probability Weighting, Matching, and Time Series Analysis, researchers can enhance their ability to understand and estimate causal effects in diverse settings, contributing to evidence-based decision-making and advancing our understanding of complex phenomena.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>